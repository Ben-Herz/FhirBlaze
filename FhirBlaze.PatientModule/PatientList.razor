@page "/patient"
@using FhirBlaze.QuestionnaireModule
@using FhirBlaze.SharedComponents

    <nav class="navbar navbar-light bg-light">
        <a class="navbar-brand" href="#">Patients</a>
        <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
                <button @onclick="ToggleCreate" class="btn btn-primary">@(ShowCreate?"Cancel": "Add Patient")</button>
                <button @onclick="ToggleSearch" class="btn btn-primary">@(ShowSearch?"Cancel": "Search Patient")</button>
                Questionnaire: <button @onclick="()=>ToggleQList(null)" class="btn btn-primary">@((string.IsNullOrEmpty(QuestionnaireId))?"Select": "Change")</button>   
            </li>
        </ul>
    </nav>
        @if (ShowQuestionnaireList)
        {
            <QuestionnaireList OnSelectClick="ToggleQList" />
        }
       @if (ShowCreate)
                {
                    <PatientCreate Patient="DraftPatient" Processing="@ProcessingCreate" CreatePatient="CreatePatient" />
                   
                }

                @if (ShowSearch)
                {
                     <PatientSearch Patient="DraftPatient" Processing="@ProcessingSearch" SearchPatient="SearchPatient" />
                }
                @if (ShowUpdate)
                {
                    <PatientUpdate Patient="EditPatient" Processing="@ProcessingSearch" UpdatePatient="UpdatePatient" />
                    <button class="btn btn-secondary" @onclick=@ToggleUpdate>Cancel!</button>
                    <!-- 
                    <PatientDetail CurrentPatient="@SelectedPatient"/>
                    -->
                }
    <div class="container">
             
        
        <br/>
        <div class="container">
            
                    <table class="table table-striped table-hover">
                        <thead>
                        <tr>
                            <th>Name</th>
                            <th>DOB</th>
                        </tr>
                        </thead>
                        <tbody>
                        @foreach (var patient in Patients)
                        {
                            <tr  >
                                <td>@patient.Name.FirstOrDefault()</td>
                                <td>@patient.BirthDate</td>
                                <td>
                                    <button @onclick="@(e => PatientSelected(e, patient))" class="btn btn-primary">Edit</button>
                                    <ChestistLauncher CurrentPatient=@patient/>
                                    <button @onclick="@((e)=> ShowQuestionnaire(patient.Id))" class="btn btn-primary">View</button>
                                </td>
                            </tr>
                        }
                        </tbody>
                    </table>
                
            </div>
        
        <br />
        <h3>Found: @Patients.Count patients!</h3>

        <!--<FhirBlaze.SharedComponents.LoadingSpinner />-->
    </div>


@code {
    [CascadingParameter] public IModalService Modal { get; set; }

    void ShowQuestionnaire(string patientId)
    {
        var parameters = new ModalParameters();
        parameters.Add(nameof(RenderQuestionnaire.Id), QuestionnaireId);
        parameters.Add(nameof(RenderQuestionnaire.PatientId), patientId);
        Modal.Show<RenderQuestionnaire>("Questionnaire", parameters);
    }
}